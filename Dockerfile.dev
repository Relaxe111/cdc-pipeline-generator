# Development Container - Full CDC Development Environment
# Includes Python + MSSQL CLI + PostgreSQL + Fish shell + All Dependencies
FROM python:3.13-slim

# Install system dependencies, MSSQL tools, PostgreSQL client, and Fish shell
RUN apt-get update && apt-get install -y     curl     gnupg2     apt-transport-https     ca-certificates     postgresql-client     fish     git     vim     docker.io     && curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor -o /usr/share/keyrings/microsoft-prod.gpg     && curl https://packages.microsoft.com/config/debian/12/prod.list | tee /etc/apt/sources.list.d/mssql-release.list     && apt-get update     && ACCEPT_EULA=Y apt-get install -y         mssql-tools18         unixodbc-dev     && apt-get clean     && rm -rf /var/lib/apt/lists/*

# Add sqlcmd and workspace bin to PATH
ENV PATH="/opt/mssql-tools18/bin:/workspace:${PATH}"

# Set working directory
WORKDIR /workspace

# Install Python dependencies
# Note: pyproject.toml and setup.py will be available via volume mount
RUN pip install --no-cache-dir     pyyaml     ruamel.yaml     pyodbc     pgcli     jinja2     pytest     black     mypy     pylint

# Set Python to unbuffered mode for better logging
ENV PYTHONUNBUFFERED=1

# Create Fish config directory
RUN mkdir -p /root/.config/fish/completions

# Set Fish as default shell
ENV SHELL=/usr/bin/fish
SHELL ["/usr/bin/fish", "-c"]

# Default command - keep container running
CMD ["tail", "-f", "/dev/null"]
