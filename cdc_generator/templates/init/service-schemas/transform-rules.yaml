# ============================================================================
# Transform Rules Examples (Bloblang-first)
# ============================================================================
# This file is generated as a metadata catalog of reusable transform examples.
#
# IMPORTANT:
# - Runtime transform execution uses Bloblang file refs in service YAML.
# - This file is documentation/reference only (not required by the runtime).
#
# Primary usage in service YAML (recommended):
#
# sinks:
#   sink_asma.chat:
#     tables:
#       public.customer_user:
#         transforms:
#           - bloblang_ref: file://services/_bloblang/examples/user_class_splitter.blobl
#           - bloblang_ref: file://services/_bloblang/examples/active_users_only.blobl
#
# CLI usage:
#   cdc manage-services schema transforms \
#     --service <service> \
#     --sink <sink_key> \
#     --sink-table <schema.table> \
#     --add-transform file://services/_bloblang/examples/user_class_splitter.blobl
#
# List available refs:
#   cdc manage-services schema transforms --list-rules
# ============================================================================

rules:
  priority_label:
    type: conditional_column
    description: Map numeric priority to human-readable label
    bloblang_ref: file://services/_bloblang/examples/priority_label.blobl
    expected_output_column: _priority_label
    behavior: first_match_then_default
    notes:
      - Uses match-like threshold logic for this.priority.
      - Fallback is "low" when no condition matches.

  user_class_splitter:
    type: row_multiplier
    description: Split row by role flags into one row per user class
    bloblang_ref: file://services/_bloblang/examples/user_class_splitter.blobl
    expected_output_column: _user_class
    behavior: one_to_many_rows
    notes:
      - Appends one output row for each true flag.
      - Drops row when no flags are true.

  active_users_only:
    type: filter
    description: Keep only rows where is_active is true
    bloblang_ref: file://services/_bloblang/examples/active_users_only.blobl
    behavior: keep_or_drop
    notes:
      - Emits original row when condition passes.
      - Emits deleted() when condition fails.

  valid_status_filter:
    type: filter
    description: Keep only rows with active or pending status
    bloblang_ref: file://services/_bloblang/examples/valid_status_filter.blobl
    behavior: keep_or_drop
    notes:
      - OR logic across accepted status values.
      - Common pre-filter before sink merge.
